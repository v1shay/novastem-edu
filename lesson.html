<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NovaSTEM EDU — Lesson</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Global Styles -->
  <link rel="stylesheet" href="styles.css" />

  <style>
    body {
      background: #e6f4ec;

  <div class="lesson-box" id="learn-section"></div>

    }

    /* ===============================
       LAYOUT
    ================================ */
    .lesson-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .lesson-box {
      background: white;
      padding: 36px;
      border-radius: 22px;
      margin-top: 32px;
    }

    .lesson-meta {
      margin-top: 12px;
      color: #475569;
      font-size: 1.05rem;
    }

    /* ===============================
       TABS
    ================================ */
    .lesson-tabs {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .lesson-tabs button {
      padding: 10px 18px;
      border-radius: 999px;
      border: 2px solid #15803d;
      background: white;
      font-weight: 600;
      cursor: pointer;
      font-family: "Space Grotesk", sans-serif;
    }

    .lesson-tabs button.active {
      background: #15803d;
      color: white;
    }

    .lesson-section {
      margin-top: 24px;
      font-size: 1.05rem;
      line-height: 1.6;
    }

    /* ===============================
       PRACTICE INPUT
    ================================ */
    textarea {
      width: 100%;
      min-height: 140px;
      padding: 16px;
      font-size: 1rem;
      border-radius: 14px;
      border: 1px solid #cbd5e1;
      font-family: "IBM Plex Sans", sans-serif;
      margin-top: 18px;
    }

    .feedback-box {
      background: var(--bg-soft);
      border-radius: 18px;
      padding: 22px;
      margin-top: 22px;
      font-size: 1.05rem;
    }
  </style>
</head>

<body>

<!-- HERO -->
<section class="hero section">
  <div class="container hero-inner">
    <h1 id="lesson-title">Lesson</h1>

    <p class="lesson-meta">
      <strong>Goal:</strong>
      <span id="lesson-goal"></span>
    </p>

    <p class="lesson-meta" id="lesson-why"></p>

    <div class="hero-buttons" style="margin-top:16px;">
      <a href="edu.html" class="btn">← Back to EDU</a>
    </div>
  </div>
</section>

<!-- CONTENT -->
<section class="section">
  <div class="container lesson-container">

    <div class="lesson-box">

      <!-- TABS -->
      <div class="lesson-tabs">
        <button class="tab-btn active" data-tab="learn">Learn</button>
        <button class="tab-btn" data-tab="practice">Practice</button>
        <button class="tab-btn" data-tab="quiz">Quiz</button>
      </div>

      <!-- LEARN -->
      <div id="learn" class="lesson-section">
        <p><em>Learning content will be generated here.</em></p>
      </div>

      <!-- PRACTICE -->
      <div id="practice" class="lesson-section" hidden>
        <p><em>Practice activities will appear here.</em></p>
        <textarea placeholder="Explain your reasoning step by step..."></textarea>
        <div class="feedback-box" style="display:none;"></div>
      </div>

      <!-- QUIZ -->
      <div id="quiz" class="lesson-section" hidden>
        <p><em>Quiz unlocks after mastering practice. AI is disabled here.</em></p>
      </div>

    </div>
  </div>
</section>

<!-- ===============================
     CONTRACT WIRING
================================ -->
<script type="module">
  import { LESSON_CONTRACTS } from "./data/lesson-contracts.js";

  const params = new URLSearchParams(window.location.search);
  const subject = params.get("subject");
  const pillar = params.get("pillar");
  const lessonId = params.get("lesson");

  if (!subject || !pillar || !lessonId) {
    throw new Error("Missing subject, pillar, or lesson in URL");
  }

  const lesson =
    LESSON_CONTRACTS?.[subject]?.[pillar]?.[lessonId];

  if (!lesson) {
    throw new Error("Lesson contract not found");
  }

  // Render metadata
  document.getElementById("lesson-title").textContent = lesson.title;
  document.getElementById("lesson-goal").textContent =
    lesson.learningGoal.coreConcept;
  document.getElementById("lesson-why").textContent =
    lesson.learningGoal.whyItMatters;
</script>

<!-- ===============================
     TAB SWITCHING
================================ -->
<script>
  const buttons = document.querySelectorAll(".tab-btn");
  const sections = {
    learn: document.getElementById("learn"),
    practice: document.getElementById("practice"),
    quiz: document.getElementById("quiz")
  };

  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      buttons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      Object.values(sections).forEach(sec => sec.hidden = true);
      sections[btn.dataset.tab].hidden = false;
    });
  });
</script>

</body>
</html>

<script type="module">
  import { generateLearnSection } from "./lesson-engine.js";

  const params = new URLSearchParams(window.location.search);

  const subject = params.get("subject");
  const pillar = params.get("pillar");
  const lesson = params.get("lesson");

  const learnEl = document.getElementById("learn-section");

  generateLearnSection({ subject, pillar, lesson })
    .then(html => {
      learnEl.innerHTML = html;
    })
    .catch(err => {
      learnEl.innerHTML = "<p>Error loading lesson.</p>";
      console.error(err);
    });
</script>

